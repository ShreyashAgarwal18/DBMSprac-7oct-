create table Stud_Marks (
name varchar(100),
total_marks int
);

create table Result (
Roll int auto_increment primary key,
Name varchar(100),
Class varchar(50)
);

delimiter //
create function Grade_Categorization (marks int)
returns varchar(50)
deterministic
begin
declare grade varchar(50);
declare continue handler for sqlexception
signal sqlstate '45000' set MESSAGE_TEXT = 'Invalid Marks Value';
if marks < 0 or marks > 1500 then
signal sqlstate '45000' set MESSAGE_TEXT = 'Marks must be between 0 and 1500';
end if;
if marks >= 990 and marks <= 1500 then
set grade = 'Distinction';
elseif marks >= 900 and marks <= 989 then
set grade = 'First Class';
elseif marks >= 825 and marks <= 899 then
set grade = 'Higher Second Class';
else
set grade = 'Not Categorized';
end if;
return grade;
end //

delimiter ;

delimiter //
create procedure proc_Grade()
begin
declare done int default 0;
declare v_name varchar(100);
declare v_total_marks int;
declare v_grade varchar(50);
declare student_cursor cursor for
select name, total_marks from Stud_Marks;
declare continue handler for not found set done = 1;
declare continue handler for sqlexception
signal sqlstate '45000' set MESSAGE_TEXT = 'Error occurred during procedure execution';
open student_cursor;
read_loop: loop
fetch student_cursor into v_name, v_total_marks;
if done then
leave read_loop;
end if;
begin
declare continue handler for sqlexception
set v_grade = 'Error in Grade Categorization';
set v_grade = Grade_Categorization(v_total_marks);
end;
insert into Result (Name, Class) values (v_name, v_grade);
end loop;
close student_cursor;
commit;
end //

delimiter ;

insert into Stud_Marks (name, total_marks)
values
('Aarav', 1200),
('Isha', 950),
('Ravi', 880),
('Priya', 800);

call proc_Grade();

select * from Result;

notee;
